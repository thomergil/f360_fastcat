# f360_fastcat

A robust Ruby utility for concatenating, optimizing, and fixing G-code files generated by Fusion 360. This tool ensures proper transitions between operations, optimizes non-cutting moves, and handles tool changes safely.

## Purpose

Fusion 360's post processors generate separate G-code files for each operation. When running these files individually, operators must manually handle tool changes and ensure proper positioning between operations. The `f360_fastcat` utility automates this process by properly concatenating multiple G-code files while:

- Maintaining safe Z heights between operations
- Properly sequencing tool changes
- Optimizing travel moves with appropriate feed rates
- Removing redundant commands

## ⚠️ Warning / Disclaimer

This software is provided "as-is" without any warranties. Use at your own risk. The author(s) assume no responsibility for any damage to CNC machines or other equipment resulting from the use of this utility. 

**Always verify, simulate, and review the generated G-code before running it on your machine.** Incorrect G-code can cause unexpected machine behavior, equipment damage, or personal injury.

## Features

- **Intelligent Safe Height Detection**:
  - Analyzes maximum Z heights across all files for reliable safety heights
  - User-configurable overrides
  - Minimum safe height enforcement

- **Tool Change Management**:
  - Automatic detection of tool changes between files
  - Proper sequencing of commands for safe tool changes
  - Clear operator instructions for manual tool changes

- **Performance Optimization**:
  - Travel feed rate optimization for non-cutting moves
  - Sets appropriate feed rates based on Z position
  - Removal of redundant commands between operations

- **Feed Rate Management**:
  - Automatically detects when tool is in travel motion
  - Applies optimized feed rates for travel moves
  - Restores previous feed rate when returning to cutting

- **Robust Error Handling**:
  - Comprehensive validation of input files
  - Detailed error reporting
  - Validation of output G-code for safety

## Limitations

- **Coolant Commands**: If your workflow uses coolant commands (M7, M8, M9), these may require special handling. The utility attempts to preserve spindle control commands but may not maintain coolant states across operations.

- **Custom Post-Processors**: The utility is optimized for standard Fusion 360 post-processors. Custom post-processors may generate G-code with different structures requiring adjustments to the processing logic.

## Requirements

- Ruby 2.0 or higher

## Installation

1. Clone or download this repository
2. Make the script executable: `chmod +x f360_fastcat`
3. Optional: create a symlink to the script in your path for easier access

## Usage

```
f360_fastcat [options] input_file1 [input_file2 ...] output_file
```

### Options

- `-v, --verbose`: Enable verbose output
- `--fast`: Enable feed rate optimization for non-cutting moves
- `--safe-height VALUE`: Override the detected safe height (in mm)
- `--travel-feedrate VALUE`: Set feed rate for travel moves (mm/min)
- `--dry-run`: Print the final G-code to the terminal without writing to a file

## Examples

**Basic concatenation:**
```bash
f360_fastcat input1.nc input2.nc output.nc
```

**Enable fast mode with feed rate optimizations:**
```bash
f360_fastcat --fast input1.nc input2.nc output.nc
```

**Custom safe height and travel feed rate:**
```bash
f360_fastcat --safe-height 10 --travel-feedrate 500 input1.nc input2.nc output.nc
```

**Verbose mode with dry run:**
```bash
f360_fastcat -v --dry-run input1.nc input2.nc output.nc
```

## Contributing

Contributions, issues, and feature requests are welcome. Please use the issue tracker to report bugs or suggest enhancements.

## License

This project is released under the MIT License.
